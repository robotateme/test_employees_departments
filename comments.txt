Пришлось использовать CTE поскольку таблица обладает динамической глубиной вложенности.
В другом случае можно было бы обойтись JOIN. кол-во таковых в запросе, зависит от глубины вложенности.
В виду отсутствия RIGHT JOIN в SQLite есть небольшая помарка при результирующей выборке, выборка ведется из присоединяемой таблицы.
Опять же с JOIN сомневаюсь что можно точно определять родословную каждого элемента.
Для облегчения текущего запроса, можно использовать VIEW или TEMP, запоминать результаты или создавать таблицу в памяти.
Функционал приложения позволяет обновлять все данные по команде init. Конструкция таблицы позволяет испрользовать минимальное кол-во памяти в виду малого количества столбцов, отсутсвия ENUM. Так же можно сократить столбик с NULL до 0.
